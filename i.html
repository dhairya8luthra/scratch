if (visualization && visualization.trim()) {
      const visualizationDiv = document.createElement('div');
      visualizationDiv.className = 'visualization-container';
      visualizationDiv.innerHTML = `
        <div class="visualization-header">
          <div class="visualization-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 3V21H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 9L12 6L16 10L20 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <span>Data Visualization</span>
        </div>
        <div class="visualization-content">
          ${visualization}
        </div>
      `;
      
      // Insert visualization after the text but before the reasoning button
      if (reasoningButton) {
        contentDiv.insertBefore(visualizationDiv, reasoningButton);
      } else {
        contentDiv.appendChild(visualizationDiv);
      }
    }
